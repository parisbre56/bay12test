<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="description" content="A page used to calculate stat and skill levels for characters of the Einsteinian Roulette forum RTD game of the Bay12 Forums.">
	<meta name="keywords" content="Einsteinian Roulette, Level Up, Character Calculator">
	<meta name="author" content="Parisbre56">
	<title>ER Character Calculator</title>
	<link rel="shortcut icon" type="image/x-icon" href="http://parisbre56-phpexperiment.rhcloud.com/favicon.ico"/>
	<link rel="icon" type="image/x-icon" href="http://parisbre56-phpexperiment.rhcloud.com/favicon.ico"/>
	<link rel="stylesheet" type="text/css" href="http://parisbre56-phpexperiment.rhcloud.com/standardERStyle.css">
</head> 

<body>

<noscript><p class="error">Sorry, your browser does not support JavaScript!</p></noscript>
<script type="text/javascript">
  "use strict";
  
  //Simple function to compute the sign
  function sign(x) {
    return typeof x === 'number' ? x ? x < 0 ? -1 : 1 : x === x ? 0 : NaN : NaN;
  }

  //Returns the triangular number sequence (...,-3,-1,0,1,3,6,10,...)
  function triSeq(I) {
    return sign(I)*(Math.abs(I)+1)*Math.abs(I)/2;
  }

  //Returns the points needed for the skill level given
  function getPDelta(I) {
    return sign(I)*(Math.abs(I)+1)*Math.abs(I)*2.5; // 5/2=2.5
  }

  //Returns the total skill level based on points allocated and initial skill level
  function computeSkillLevel(P,I) { //P is points in skill, I is initial level of skill
    var PDelta = getPDelta(I);
    if(P+PDelta < 0) {
      return -Math.ceil(-0.5 + Math.sqrt(5 + 8*Math.abs(PDelta+P))/4.472135955); //2*sqrt(5)
    } else {
      return Math.floor((-0.5 + Math.sqrt(5 + 8*Math.abs(PDelta+P))/4.472135955)+ 0.00001);
    }
  }
  
  //Updates a stat on change of its inputs
  function updateStat(P, I, T, L, R, TR) { 
    //T is total, L is points left until next level, R is extra points for enhancement or similar
    var PN = parseInt(document.getElementById(P).value); //Points
    var IN = parseInt(document.getElementById(I).value); //Initial level
    var TE = document.getElementById(T); //Total skill (element for output)
    var LE = document.getElementById(L); //Points left for next level (element for output)
    var RC = parseInt(document.getElementById(R).value); //Is the stat enhanced?
    var TableRowElements = document.getElementsByClassName(TR); //The row the data is stored
    var SkillLevel=computeSkillLevel(PN,IN);
    var totalLevel = SkillLevel+RC;
    TE.innerHTML=(totalLevel).toString(); //Write total skill level
    
    //Change colour of the row
	//First select the colour
	var newColor='yellow';
    if(totalLevel==0) {
    	newColor='yellow';
    } 
    else if (totalLevel > 0) {
    	newColor='limegreen';
    }
    else {
    	newColor='red';
    }
	//And then apply it to each member of the class
	for(var curTRElem = 0 ; curTRElem < TableRowElements.length ; curTRElem++) {
		TableRowElements[curTRElem].style.color=newColor;
	}
    
    //Write points left for next level
    //It is the ([the points needed for the next level]-[the points needed for this level])-
    //([current points]-([the points needed for this level] - [the points needed for the initial skill level]))
    LE.innerHTML=(getPDelta(SkillLevel+1)-getPDelta(SkillLevel))-(PN-(getPDelta(SkillLevel)-getPDelta(IN)));
  }
  
  //Notifies the user of any problem with their skill levels by changing a textbox in the end
  function writeInitialLevelStatProblems (S, D, E, C, M, F, I) {
    //Strength, Dexterity, Endurance, Charisma, Mind, Fate, Intuition
    //<p class="error"><output id="StatErrorText"></output></p>
    //Total positive initial levels: <output id="PositiveStatLevels">0</output><br>
    //Total negative initial levels: <output id="NegativeStatLevels">0</output> <output id="NegativeStatLevelDelta"></output><br>
    //Total negative initial levels needed: <output id="NegativeStatLevelsNeeded">0</output><br>
    
    //for all arguments, find the total positive and negative levels
    var temp=0;
    var totalNegative=0;
    var totalPositive=0;
    var overLimitPositiveDetected=false;
    var overLimitNegativeDetected=false;
	var bonusPlus = false;
    for (var i=0; i < arguments.length; i++) {
        temp=parseInt(document.getElementById(arguments[i]).value);
        if(temp<0) {
          totalNegative+=temp;
          if(temp<-2) {
            overLimitNegativeDetected=true;
          }
        } else {
		  if(temp>0 && !bonusPlus && totalPositive>0){
			bonusPlus = true;
			totalPositive-=1;
		  }
          totalPositive+=temp;
          if(temp>2) {
            overLimitPositiveDetected=true;
          }
        }
    }
    //Find the negative levels needed for the positive levels given
    var negativeNeeded=-triSeq(totalPositive);
    if(bonusPlus){
		negativeNeeded-= 1;
		totalPositive += 1;
	}
	
    //Display error
    if(overLimitNegativeDetected) {
      document.getElementById("StatErrorText").innerHTML="Initial stat levels can't be less than -2";
    }
    else if(overLimitPositiveDetected) {
      document.getElementById("StatErrorText").innerHTML="Initial stat levels can't be more than 2";
    }
    else {
      document.getElementById("StatErrorText").innerHTML="";
    }
    
    //Display statistics 
    document.getElementById("PositiveStatLevels").innerHTML=totalPositive;
    document.getElementById("NegativeStatLevels").innerHTML=totalNegative;
    if(negativeNeeded-totalNegative<0) { //-5-(-3)=-2 more levels needed
      document.getElementById("NegativeStatLevelDelta").innerHTML="("+Math.abs(negativeNeeded-totalNegative).toString()+" more negative levels needed)";
    }
    else if(negativeNeeded-totalNegative>0) { //-5-(-7)=2 more negative levels than necessary
      document.getElementById("NegativeStatLevelDelta").innerHTML="("+Math.abs(negativeNeeded-totalNegative).toString()+" more negative levels than necessary)";
    }
    else { //if equal, say nothing
      document.getElementById("NegativeStatLevelDelta").innerHTML="";
    }
    document.getElementById("NegativeStatLevelsNeeded").innerHTML=negativeNeeded;
  }
  
  //Notifies the user of any problem with their stat levels by changing a textbox in the end
  function writeInitialLevelSkillProblems (H, C, U, E, A, M, G) {
    //Handiwork, Conventional, Unconventional, Exotic, Auxilliary, Medical, Gen.Knowledge
    
    //for all arguments, find the total positive and negative levels
    var temp=0;
    var totalNegative=0;
    var totalPositive=0;
    var overLimitPositiveDetected=false;
    var overLimitNegativeDetected=false;
	var bonusPlus = false;
    for (var i=0; i < arguments.length; i++) {
        temp=parseInt(document.getElementById(arguments[i]).value);
        if(temp<0) {
          totalNegative+=temp;
          if(temp<-2) {
            overLimitNegativeDetected=true;
          }
        } else {
		  if(temp>0 && !bonusPlus && totalPositive>0){
			bonusPlus = true;
			totalPositive-=1;
		  }
          totalPositive+=temp;
          if(temp>2) {
            overLimitPositiveDetected=true;
          }
        }
    }
    //Find the negative levels needed for the positive levels given
    var negativeNeeded=-triSeq(totalPositive);
	if(bonusPlus){
		negativeNeeded-= 1;
		totalPositive += 1;
	}
    
    //Display error
    if(overLimitNegativeDetected) {
      document.getElementById("SkillErrorText").innerHTML="Initial Skill levels can't be less than -2";
    }
    else if(overLimitPositiveDetected) {
      document.getElementById("SkillErrorText").innerHTML="Initial Skill levels can't be more than 2";
    }
    else {
      document.getElementById("SkillErrorText").innerHTML="";
    }
    
    //Display Skillistics 
    document.getElementById("PositiveSkillLevels").innerHTML=totalPositive;
    document.getElementById("NegativeSkillLevels").innerHTML=totalNegative;
    if(negativeNeeded-totalNegative<0) { //-5-(-3)=-2 more levels needed
      document.getElementById("NegativeSkillLevelDelta").innerHTML="("+Math.abs(negativeNeeded-totalNegative).toString()+" more negative levels needed)";
    }
    else if(negativeNeeded-totalNegative>0) { //-5-(-7)=2 more negative levels than necessary
      document.getElementById("NegativeSkillLevelDelta").innerHTML="("+Math.abs(negativeNeeded-totalNegative).toString()+" more negative levels than necessary)";
    }
    else { //if equal, say nothing
      document.getElementById("NegativeSkillLevelDelta").innerHTML="";
    }
    document.getElementById("NegativeSkillLevelsNeeded").innerHTML=negativeNeeded;
  }
  
  //Compute stat point total and mission total and write them in a text box in the end
  function writeStatPointProblems (S, D, E, C, M, F, I) {
    //Strength, Dexterity, Endurance, Charisma, Mind, Fate, Intuition
    //<p class="error"><output id="StatErrorText"></output></p>
    //Point total: <output id="TotalStatPoints">0</output> 
    //(<output id="StatMissions">0</output> Mission(s), <output id="StatExtra">0</output> extra points)<br>
    
    var temp=0;
    var total=0;
    var negativeDetected=false;
    //Get the total points
    for (var i=0; i < arguments.length; i++) {
      temp=parseInt(document.getElementById(arguments[i]).value);
      total+=temp;
      if(temp<0) {
        negativeDetected=true;
      }
    }
    
    //Print error
    if(negativeDetected) {
      document.getElementById("StatErrorText").innerHTML="Stat points can't be negative";
    }
    
    //Print statistics
    document.getElementById("TotalStatPoints").innerHTML=total.toString();
    document.getElementById("StatMissions").innerHTML=Math.floor(total/5).toString();
    document.getElementById("StatExtra").innerHTML=(total%5).toString();
  }
  
  //Compute skill point total and mission total and write them in a text box in the end
  function writeSkillPointProblems (H, C, U, E, A, M, G) {
    //Handiwork, Conventional, Unconventional, Exotic, Auxilliary, Medical, Gen.Knowledge
    
    var temp=0;
    var total=0;
    var negativeDetected=false;
    //Get the total points
    for (var i=0; i < arguments.length; i++) {
      temp=parseInt(document.getElementById(arguments[i]).value);
      total+=temp;
      if(temp<0) {
        negativeDetected=true;
      }
    }
    
    //Print error
    if(negativeDetected) {
      document.getElementById("SkillErrorText").innerHTML="Skill points can't be negative";
    }
    
    //Print Skillistics
    document.getElementById("TotalSkillPoints").innerHTML=total.toString();
    document.getElementById("SkillMissions").innerHTML=Math.floor(total/5).toString();
    document.getElementById("SkillExtra").innerHTML=(total%5).toString();
    
  }
  
  function refreshTables() {
    writeInitialLevelStatProblems('StrI','DexI','EndI','ChaI','MindI','FateI','IntuI');
    writeStatPointProblems('StrP','DexP','EndP','ChaP','MindP','FateP','IntuP');
    
    updateStat('StrP','StrI','StrT','StrL','StrR','StrTR');
    updateStat('DexP','DexI','DexT','DexL','DexR','DexTR');
    updateStat('EndP','EndI','EndT','EndL','EndR','EndTR');
    updateStat('ChaP','ChaI','ChaT','ChaL','ChaR','ChaTR');
    updateStat('MindP','MindI','MindT','MindL','MindR','MindTR');
    updateStat('FateP','FateI','FateT','FateL','FateR','FateTR');
    updateStat('IntuP','IntuI','IntuT','IntuL','IntuR','IntuTR');
    
    writeInitialLevelSkillProblems('HanI','ConI','UnconI','ExoI','AuxI','MedI','GenI');
    writeSkillPointProblems('HanP','ConP','UnconP','ExoP','AuxP','MedP','GenP');
    
    updateStat('HanP','HanI','HanT','HanL','HanR','HanTR');
    updateStat('ConP','ConI','ConT','ConL','ConR','ConTR');
    updateStat('UnconP','UnconI','UnconT','UnconL','UnconR','UnconTR');
    updateStat('ExoP','ExoI','ExoT','ExoL','ExoR','ExoTR');
    updateStat('AuxP','AuxI','AuxT','AuxL','AuxR','AuxTR');
    updateStat('MedP','MedI','MedT','MedL','MedR','MedTR');
    updateStat('GenP','GenI','GenT','GenL','GenR','GenTR');
  }
  
  window.onload = refreshTables;
</script>

<h1>Stat and Skill Rules</h1>
<h3>Character creation</h3>
<ul>
  <li>Everyone starts with zero levels and zero points in all stats and skills.</li>
  <li>You can add positive levels during character creation, but must take a greater penalty each time you do so. These are reffered to as 'Initial levels' in this page.
  <ul>
    <li>Having a <em>total</em> of +1 positive intial levels means you must take a total of -1 negative intial levels.</li>
    <li>Having a <em>total</em> of +2 positive intial levels means you must take a total of -3 negative intial levels.</li>
    <li>Having a <em>total</em> of +3 positive intial levels means you must take a total of -6 negative intial levels.</li>
    <li>Having a <em>total</em> of +4 positive intial levels means you must take a total of -10 negative intial levels.</li>
    <li>Note that the total is different between stats and skills. <br>You cannot mix the total initial levels for stats with the total initial levels for skills. <br>You <strong>cannot</strong> have +1 strength and +1 willpower for -2 endurance and -1 conventional.</li>
  </ul></li>
  <li>Your second increase to 1 can be taken at a cost of -1
  <ul>
    <li>This +1 does not count toward the cummulative total</li>
	<li>This 1 *can* be increased, using the normal system</li>
  </ul></li>
  <li>You can not have an initial level lower than -2.</li>
  <li><strong>Only</strong> during character generation, you cannot have an initial level greater than 2.</li>
</ul>
<h3>Level up</h3>
<ul>
  <li>You get 5 points for stats and 5 for skills at the end of each mission.
  <ul>
    <li>Getting from level -2 to level -1 takes 10 points.</li>
    <li>Getting from level -1 to level 0 takes 5 points.</li>
    <li>Getting from level 0 to level 1 takes 5 points.</li>
    <li>Getting from level 1 to level 2 takes 10 points.</li>
    <li>Getting from level 2 to level 3 takes 15 points.</li>
    <li>Getting from level 3 to level 4 takes 20. <br>To get to level 4 from level 0, in other words, you'd need to spend 50 points, or 10 missions worth. <br>On the other hand, if you have an initial level of 2 on a skill, you can reach level 4 with just 35 points or 7 missions worth.</li>
  </ul></li>
  <li>Note that special circumstances (brain damage, genemods, alien parasites, Doctor experimentation, etc.) may change the number of points given or may result in point deduction.</li>
  <li>Enhanced Capacity upgrades are addons that can be bought from the armoury and can give you a +1 to <strong>either</strong> 1 stat or 1 skill. You can have only one of them installed at a time.</li>
</ul>

<h3>Extra rules for old characters</h3>
<ul>
  <li>The Anompalous Planetoid mission counts as two missions and thus gives two levelups instead of one.</li>
  <li>Those that got points during the Hephaestus timeskip get 5 extra points to put in <strong>either</strong> stats or skills or a combination of the two. <br>That means that they can put 2 points in strength and 3 points in intuition, for example.</li>
  <li>Those that participated in the Hephaestus space battle get 5 extra points to put in <strong>either</strong> stats or skills or a combination of the two. <br>That means that they can put 2 points in strength and 3 points in intuition, for example.</li>
  <li>Lars gets a +1 level to Fate without the need to take extra negative levels for it.</li>
</ul>

<div id="SNSData" class="container">
	<small>Note: You can hover over parts of the table to see more info about them.</small>
<table oninput="refreshTables();">
<tr>
		<th colspan="6" class="tableTitle"><h2>Stats</h2></th>
	<td class="separator">&nbsp;</td>
		<th colspan="6" class="tableTitle"><h2>Skills</h2></th>
</tr>
  <tr class="colTitle">
		<th title="The name of the Stat. Hover over it for more info">
			Name</th>
		<th title="The points assigned to that Stat">
			Points assigned</th>
		<th title="The level of the Stat during character creation">
			Initial level</th>
		<th title="The level of the Stat after all points and bonuses are applied">
			Total level</th>
		<th title="How many more points you must put to that Stat to reach the next level">
			Points for next level</th>
		<th title="Whether or not you have any extra levels in this Stat due to other reasons, such as genemods, the deathcube or doctor modifiactions">
			Enhanced Capacity</th>
	<td class="separator">&nbsp;</td>
		<th title="The name of the Skill. Hover over it for more info">
			Name</th>
		<th title="The level of the Skill during character creation">
			Points assigned</th>
		<th title="The level of the Skill after all points and bonuses are applied">
			Initial level</th>
		<th title="The level of the Skill after all points and bonuses are applied">
			Total level</th>
		<th title="How many more points you must put to that Skill to reach the next level">
			Points for next level</th>
		<th title="Whether or not you have any extra levels in this Skill due to other reasons, such as genemods, the deathcube or doctor modifiactions">
			Enhanced Capacity</th>
  </tr>
  <tr>
		<th class="StrTR">Strength</th>
		<td class="StrTR"><input type="number" id="StrP" value="0"></td>
		<td class="StrTR"><input type="number" id="StrI" value="0"></td>
		<td class="StrTR"><output id="StrT">0</output></td>
		<td class="StrTR"><output id="StrL">5</output></td>
		<td class="StrTR"><input type="number" id="StrR" value="0"></td>
  	<td class="separator">&nbsp;</td>
		<th class="HanTR">Handiwork</th>
		<td class="HanTR"><input type="number" id="HanP" value="0"></td>
		<td class="HanTR"><input type="number" id="HanI" value="0"></td>
		<td class="HanTR"><output id="HanT">0</output></td>
		<td class="HanTR"><output id="HanL">5</output></td>
		<td class="HanTR"><input type="number" id="HanR" value="0"></td>
  </tr>
  <tr>
		<th class="DexTR">Dexterity</th>
		<td class="DexTR"><input type="number" id="DexP" value="0"></td>
		<td class="DexTR"><input type="number" id="DexI" value="0"></td>
		<td class="DexTR"><output id="DexT">0</output></td>
		<td class="DexTR"><output id="DexL">5</output></td>
		<td class="DexTR"><input type="number" id="DexR" value="0"></td>
	<td class="separator">&nbsp;</td>
		<th class="ConTR">Conventional</th>
		<td class="ConTR"><input type="number" id="ConP" value="0"></td>
		<td class="ConTR"><input type="number" id="ConI" value="0"></td>
		<td class="ConTR"><output id="ConT">0</output></td>
		<td class="ConTR"><output id="ConL">5</output></td>
		<td class="ConTR"><input type="number" id="ConR" value="0"></td>
  </tr>
	    <th class="EndTR">Endurance</th>
	    <td class="EndTR"><input type="number" id="EndP" value="0"></td>
	    <td class="EndTR"><input type="number" id="EndI" value="0"></td>
	    <td class="EndTR"><output id="EndT">0</output></td>
	    <td class="EndTR"><output id="EndL">5</output></td>
	    <td class="EndTR"><input type="number" id="EndR" value="0"></td>
	<td class="separator">&nbsp;</td>
		<th class="UnconTR">Unconventional</th>
		<td class="UnconTR"><input type="number" id="UnconP" value="0"></td>
		<td class="UnconTR"><input type="number" id="UnconI" value="0"></td>
		<td class="UnconTR"><output id="UnconT">0</output></td>
		<td class="UnconTR"><output id="UnconL">5</output></td>
		<td class="UnconTR"><input type="number" id="UnconR" value="0"></td>
  </tr>
  <tr>
		<th class="ChaTR">Charisma</th>
		<td class="ChaTR"><input type="number" id="ChaP" value="0"></td>
		<td class="ChaTR"><input type="number" id="ChaI" value="0"></td>
		<td class="ChaTR"><output id="ChaT">0</output></td>
		<td class="ChaTR"><output id="ChaL">5</output></td>
		<td class="ChaTR"><input type="number" id="ChaR" value="0"></td>
	<td class="separator">&nbsp;</td>
		<th class="ExoTR">Exotic</th>
		<td class="ExoTR"><input type="number" id="ExoP" value="0"></td>
		<td class="ExoTR"><input type="number" id="ExoI" value="0"></td>
		<td class="ExoTR"><output id="ExoT">0</output></td>
		<td class="ExoTR"><output id="ExoL">5</output></td>
		<td class="ExoTR"><input type="number" id="ExoR" value="0"></td>
  </tr>
  <tr>
		<th class="MindTR">Mind</th>
		<td class="MindTR"><input type="number" id="MindP" value="0"></td>
		<td class="MindTR"><input type="number" id="MindI" value="0"></td>
		<td class="MindTR"><output id="MindT">0</output></td>
		<td class="MindTR"><output id="MindL">5</output></td>
		<td class="MindTR"><input type="number" id="MindR" value="0"></td>
	<td class="separator">&nbsp;</td>
		<th class="AuxTR">Auxiliary</th>
		<td class="AuxTR"><input type="number" id="AuxP" value="0"></td>
		<td class="AuxTR"><input type="number" id="AuxI" value="0"></td>
		<td class="AuxTR"><output id="AuxT">0</output></td>
		<td class="AuxTR"><output id="AuxL">5</output></td>
		<td class="AuxTR"><input type="number" id="AuxR" value="0"></td>
  </tr>
  <tr>
		<th class="FateTR">Fate</th>
		<td class="FateTR"><input type="number" id="FateP" value="0"></td>
		<td class="FateTR"><input type="number" id="FateI" value="0"></td>
		<td class="FateTR"><output id="FateT">0</output></td>
		<td class="FateTR"><output id="FateL">5</output></td>
		<td class="FateTR"><input type="number" id="FateR" value="0"></td>
	<td class="separator">&nbsp;</td>
		<th class="MedTR">Medical</th>
		<td class="MedTR"><input type="number" id="MedP" value="0"></td>
		<td class="MedTR"><input type="number" id="MedI" value="0"></td>
		<td class="MedTR"><output id="MedT">0</output></td>
		<td class="MedTR"><output id="MedL">5</output></td>
		<td class="MedTR"><input type="number" id="MedR" value="0"></td>
  </tr>
  <tr>
		<th class="IntuTR">Intuition</th>
		<td class="IntuTR"><input type="number" id="IntuP" value="0"></td>
		<td class="IntuTR"><input type="number" id="IntuI" value="0"></td>
		<td class="IntuTR"><output id="IntuT">0</output></td>
		<td class="IntuTR"><output id="IntuL">5</output></td>
		<td class="IntuTR"><input type="number" id="IntuR" value="0"></td>
	<td class="separator">&nbsp;</td>
		<th class="GenTR">Gen. Knowledge</th>
		<td class="GenTR"><input type="number" id="GenP" value="0"></td>
		<td class="GenTR"><input type="number" id="GenI" value="0"></td>
		<td class="GenTR"><output id="GenT">0</output></td>
		<td class="GenTR"><output id="GenL">5</output></td>
		<td class="GenTR"><input type="number" id="GenR" value="0"></td>
  </tr>
</table>
</div>

<div id="SNSInfo" class="container">
<div class="stats">
<p>
  Total positive initial levels: <output id="PositiveStatLevels">0</output><br>
  Total negative initial levels: <output id="NegativeStatLevels">0</output>  <output id="NegativeStatLevelDelta" class="warning"></output><br>
  Total negative initial levels needed: <output id="NegativeStatLevelsNeeded">0</output><br>
  Point total: <output id="TotalStatPoints">0</output> (<output id="StatMissions">0</output> Mission(s), <output id="StatExtra">0</output> extra points)<br>
</p>
</div>

<div class="skills">
<p>
  Total positive initial levels: <output id="PositiveSkillLevels">0</output><br>
  Total negative initial levels: <output id="NegativeSkillLevels">0</output>  <output id="NegativeSkillLevelDelta" class="warning"></output><br>
  Total negative initial levels needed: <output id="NegativeSkillLevelsNeeded">0</output><br>
  Point total: <output id="TotalSkillPoints">0</output> (<output id="SkillMissions">0</output> Mission(s), <output id="SkillExtra">0</output> extra points)<br>
</p>
</div>
</div>

<div id="SNSError" class="container">
<div class="stats">
<p class="error"><output id="StatErrorText"></output></p>
</div>
<div class="skills">
<p class="error"><output id="SkillErrorText"></output></p>
</div>
</div>


</table>

</body>
</html>
