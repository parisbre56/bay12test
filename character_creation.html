<!DOCTYPE html>
<html>
<body>

<noscript>Sorry, your browser does not support JavaScript!</noscript>
<script type="text/javascript">
  //Returns the triangular number sequence (...,-3,-1,0,1,3,6,10,...)
  function triSeq(I) {
    return Math.sign(I)*(Math.abs(I)+1)*Math.abs(I)/2;
  }

  //Returns the points needed for the skill level given
  function getPDelta(I) {
    return Math.sign(I)*(Math.abs(I)+1)*Math.abs(I)*2.5; // 5/2=2.5
  }

  //Returns the total skill level based on points allocated and initial skill level
  function computeSkillLevel(P,I) { //P is points in skill, I is initial level of skill
    var PDelta = getPDelta(I);
    if(P+PDelta < 0) {
      return -Math.ceil(-0.5 + Math.sqrt(5 + 8*Math.abs(PDelta+P))/4.472135955); //2*sqrt(5)
    } else {
      return Math.floor((-0.5 + Math.sqrt(5 + 8*Math.abs(PDelta+P))/4.472135955)+ 0.00001);
    }
  }
  
  //Updates a stat on change of its inputs
  function updateStat(P, I, T, L) { //T is total, L is points left until next level
    var PN = parseInt(document.getElementById(P).value); //Points
    var IN = parseInt(document.getElementById(I).value); //Initial level
    var TE = document.getElementById(T); //Total skill (element for output)
    var LE = document.getElementById(L); //Points left for next level (element for output)
    var SkillLevel=computeSkillLevel(PN,IN);
    TE.innerHTML=SkillLevel; //Write total skill level
    
    //Write points left for next level
    //It is the ([the points needed for the next level]-[the points needed for this level])-
    //([current points]-([the points needed for this level] - [the points needed for the initial skill level]))
    LE.innerHTML=(getPDelta(SkillLevel+1)-getPDelta(SkillLevel))-(PN-(getPDelta(SkillLevel)-getPDelta(IN)));
  }
  
  //Notifies the user of any problem with their skill levels by changing a textbox in the end
  function writeInitialLevelStatProblems (S, D, E, C, I, W, F) {
    //Strength, Dexterity, Endurance, Charisma, Intelligence, Will, Fate
    //<p style="color: red; font-size:30px"><output id="StatErrorText"></output></p>
    //Total positive initial levels: <output id="PositiveStatLevels">0</output></br>
    //Total negative initial levels: <output id="NegativeStatLevels">0</output> <output id="NegativeStatLevelDelta"></output></br>
    //Total negative initial levels needed: <output id="NegativeStatLevelsNeeded">0</output></br>
    
    //for all arguments, find the total positive and negative levels
    var temp=0;
    var totalNegative=0;
    var totalPositive=0;
    var overLimitPositiveDetected=false;
    var overLimitNegativeDetected=false;
    for (var i=0; i < arguments.length; i++) {
        temp=parseInt(document.getElementById(arguments[i]).value);
        if(temp<0) {
          totalNegative+=temp;
          if(temp<-2) {
            overLimitNegativeDetected=true;
          }
        } else {
          totalPositive+=temp;
          if(temp>2) {
            overLimitPositiveDetected=true;
          }
        }
    }
    //Find the negative levels needed for the positive levels given
    var negativeNeeded=-triSeq(totalPositive);
    
    //Display error
    if(overLimitNegativeDetected) {
      document.getElementById("StatErrorText").innerHTML="Initial stat levels can't be less than -2";
    }
    else if(overLimitPositiveDetected) {
      document.getElementById("StatErrorText").innerHTML="Initial stat levels can't be more than 2";
    }
    else {
      document.getElementById("StatErrorText").innerHTML="";
    }
    
    //Display statistics 
    document.getElementById("PositiveStatLevels").innerHTML=totalPositive;
    document.getElementById("NegativeStatLevels").innerHTML=totalNegative;
    if(negativeNeeded-totalNegative<0) { //-5-(-3)=-2 more levels needed
      document.getElementById("NegativeStatLevelDelta").innerHTML="("+Math.abs(negativeNeeded-totalNegative).toString()+" more negative levels needed)";
    }
    else if(negativeNeeded-totalNegative>0) { //-5-(-7)=2 more negative levels than necessary
      document.getElementById("NegativeStatLevelDelta").innerHTML="("+Math.abs(negativeNeeded-totalNegative).toString()+" more negative levels than necessary)";
    }
    else { //if equal, say nothing
      document.getElementById("NegativeStatLevelDelta").innerHTML="";
    }
    document.getElementById("NegativeStatLevelsNeeded").innerHTML=negativeNeeded;
  }
  
  //Notifies the user of any problem with their stat levels by changing a textbox in the end
  function writeInitialLevelSkillProblems (I, H, C, U, E, A, M, G) {
    //Intuition, Handiwork, Conventional, Unconventional, Exotic, Auxilliary, Medical, Gen.Knowledge
    
    //for all arguments, find the total positive and negative levels
    var temp=0;
    var totalNegative=0;
    var totalPositive=0;
    var overLimitPositiveDetected=false;
    var overLimitNegativeDetected=false;
    for (var i=0; i < arguments.length; i++) {
        temp=parseInt(document.getElementById(arguments[i]).value);
        if(temp<0) {
          totalNegative+=temp;
          if(temp<-2) {
            overLimitNegativeDetected=true;
          }
        } else {
          totalPositive+=temp;
          if(temp>2) {
            overLimitPositiveDetected=true;
          }
        }
    }
    //Find the negative levels needed for the positive levels given
    var negativeNeeded=-triSeq(totalPositive);
    
    //Display error
    if(overLimitNegativeDetected) {
      document.getElementById("SkillErrorText").innerHTML="Initial Skill levels can't be less than -2";
    }
    else if(overLimitPositiveDetected) {
      document.getElementById("SkillErrorText").innerHTML="Initial Skill levels can't be more than 2";
    }
    else {
      document.getElementById("SkillErrorText").innerHTML="";
    }
    
    //Display Skillistics 
    document.getElementById("PositiveSkillLevels").innerHTML=totalPositive;
    document.getElementById("NegativeSkillLevels").innerHTML=totalNegative;
    if(negativeNeeded-totalNegative<0) { //-5-(-3)=-2 more levels needed
      document.getElementById("NegativeSkillLevelDelta").innerHTML="("+Math.abs(negativeNeeded-totalNegative).toString()+" more negative levels needed)";
    }
    else if(negativeNeeded-totalNegative>0) { //-5-(-7)=2 more negative levels than necessary
      document.getElementById("NegativeSkillLevelDelta").innerHTML="("+Math.abs(negativeNeeded-totalNegative).toString()+" more negative levels than necessary)";
    }
    else { //if equal, say nothing
      document.getElementById("NegativeSkillLevelDelta").innerHTML="";
    }
    document.getElementById("NegativeSkillLevelsNeeded").innerHTML=negativeNeeded;
  }
  
  //Compute stat point total and mission total and write them in a text box in the end
  function writeStatPointProblems (S, D, E, C, I, W, F) {
    //Strength, Dexterity, Endurance, Charisma, Intelligence, Will, Fate
    //<p style="color: red; font-size:30px"><output id="StatErrorText"></output></p>
    //Point total: <output id="TotalStatPoints">0</output> 
    //(<output id="StatMissions">0</output> Mission(s), <output id="StatExtra">0</output> extra points)</br>
    
    var temp=0;
    var total=0;
    var negativeDetected=false;
    //Get the total points
    for (var i=0; i < arguments.length; i++) {
      temp=parseInt(document.getElementById(arguments[i]).value);
      total+=temp;
      if(temp<0) {
        negativeDetected=true;
      }
    }
    
    //Print error
    if(negativeDetected) {
      document.getElementById("StatErrorText").innerHTML="Stat points can't be negative";
    }
    
    //Print statistics
    document.getElementById("TotalStatPoints").innerHTML=total.toString();
    document.getElementById("StatMissions").innerHTML=Math.floor(total/5).toString();
    document.getElementById("StatExtra").innerHTML=(total%5).toString();
  }
  
  //Compute skill point total and mission total and write them in a text box in the end
  function writeSkillPointProblems (I, H, C, U, E, A, M, G) {
    //Intuition, Handiwork, Conventional, Unconventional, Exotic, Auxilliary, Medical, Gen.Knowledge
    
    var temp=0;
    var total=0;
    var negativeDetected=false;
    //Get the total points
    for (var i=0; i < arguments.length; i++) {
      temp=parseInt(document.getElementById(arguments[i]).value);
      total+=temp;
      if(temp<0) {
        negativeDetected=true;
      }
    }
    
    //Print error
    if(negativeDetected) {
      document.getElementById("SkillErrorText").innerHTML="Skill points can't be negative";
    }
    
    //Print Skillistics
    document.getElementById("TotalSkillPoints").innerHTML=total.toString();
    document.getElementById("SkillMissions").innerHTML=Math.floor(total/5).toString();
    document.getElementById("SkillExtra").innerHTML=(total%5).toString();
    
  }
</script>


<h1>Character creation test</h1>
<h2>Stats</h2>
<table border="1" oninput="writeInitialLevelStatProblems('StrI','DexI','EndI','ChaI','IntelI','WillI','FateI');writeStatPointProblems('StrP','DexP','EndP','ChaP','IntelP','WillP','FateP');">
  <tr>
    <td><strong>Name</strong></td>
    <td><strong>Points assigned</strong></td>
    <td><strong>Initial level</strong></td>
    <td><strong>Total level</strong></td>
    <td><strong>Left for next level</strong></td>
  </tr>
  <tr oninput="updateStat('StrP','StrI','StrT','StrL');">
      <td>Strength</td>
      <td><input type="number" id="StrP" value="0"></td>
      <td><input type="number" id="StrI" value="0"></td>
      <td><output id="StrT">0</output></td>
      <td><output id="StrL">5</output></td>
  </tr>
  <tr oninput="updateStat('DexP','DexI','DexT','DexL');">
      <td>Dexterity</td>
      <td><input type="number" id="DexP" value="0"></td>
      <td><input type="number" id="DexI" value="0"></td>
      <td><output id="DexT">0</output></td>
      <td><output id="DexL">5</output></td>
  </tr>
  <tr oninput="updateStat('EndP','EndI','EndT','EndL');">
      <td>Endurance</td>
      <td><input type="number" id="EndP" value="0"></td>
      <td><input type="number" id="EndI" value="0"></td>
      <td><output id="EndT">0</output></td>
      <td><output id="EndL">5</output></td>
  </tr>
  <tr oninput="updateStat('ChaP','ChaI','ChaT','ChaL');">
      <td>Charisma</td>
      <td><input type="number" id="ChaP" value="0"></td>
      <td><input type="number" id="ChaI" value="0"></td>
      <td><output id="ChaT">0</output></td>
      <td><output id="ChaL">5</output></td>
  </tr>
  <tr oninput="updateStat('IntelP,'IntelI','IntelT','IntelL');">
      <td>Intelligence</td>
      <td><input type="number" id="IntelP" value="0"></td>
      <td><input type="number" id="IntelI" value="0"></td>
      <td><output id="IntelT">0</output></td>
      <td><output id="IntelL">5</output></td>
  </tr>
  <tr oninput="updateStat('WillP','WillI','WillT','WillL');">
      <td>Willlpower</td>
      <td><input type="number" id="WillP" value="0"></td>
      <td><input type="number" id="WillI" value="0"></td>
      <td><output id="WillT">0</output></td>
      <td><output id="WillL">5</output></td>
  </tr>
  <tr oninput="updateStat('FateP','FateI','FateT','FateL');">
      <td>Fate</td>
      <td><input type="number" id="FateP" value="0"></td>
      <td><input type="number" id="FateI" value="0"></td>
      <td><output id="FateT">0</output></td>
      <td><output id="FateL">5</output></td>
  </tr>
</table>

</br>
<p style="color: red; font-size:30px"><output id="StatErrorText"></output></p>
<p>
  Total positive initial levels: <output id="PositiveStatLevels">0</output></br>
  Total negative initial levels: <output id="NegativeStatLevels">0</output>  <output id="NegativeStatLevelDelta"></output></br>
  Total negative initial levels needed: <output id="NegativeStatLevelsNeeded">0</output></br>
  Point total: <output id="TotalStatPoints">0</output> (<output id="StatMissions">0</output> Mission(s), <output id="StatExtra">0</output> extra points)</br>
</p>

<h2>Skills</h2>
<table border="1" oninput="writeInitialLevelSkillProblems('IntuI','HanI','ConI','UnconI','ExoI','AuxI','MedI','GenI');writeSkillPointProblems('IntuP','HanP','ConP','UnconP','ExoP','AuxP','MedP','GenP');">
  <tr oninput="updateStat('IntuP','IntuI','IntuT','IntuL');">
      <td>Intuition</td>
      <td><input type="number" id="IntuP" value="0"></td>
      <td><input type="number" id="IntuI" value="0"></td>
      <td><output id="IntuT">0</output></td>
      <td><output id="IntuL">5</output></td>
  </tr>
  <tr oninput="updateStat('HanP','HanI','HanT','HanL');">
      <td>Handiwork</td>
      <td><input type="number" id="HanP" value="0"></td>
      <td><input type="number" id="HanI" value="0"></td>
      <td><output id="HanT">0</output></td>
      <td><output id="HanL">5</output></td>
  </tr>
  <tr oninput="updateStat('ConP','ConI','ConT','ConL');">
      <td>Conventional</td>
      <td><input type="number" id="ConP" value="0"></td>
      <td><input type="number" id="ConI" value="0"></td>
      <td><output id="ConT">0</output></td>
      <td><output id="ConL">5</output></td>
  </tr>
  <tr oninput="updateStat('UnconP','UnconI','UnconT','UnconL');">
      <td>Unconventional</td>
      <td><input type="number" id="UnconP" value="0"></td>
      <td><input type="number" id="UnconI" value="0"></td>
      <td><output id="UnconT">0</output></td>
      <td><output id="UnconL">5</output></td>
  </tr>
  <tr oninput="updateStat('ExoP','ExoI','ExoT','ExoL');">
      <td>Exotic</td>
      <td><input type="number" id="ExoP" value="0"></td>
      <td><input type="number" id="ExoI" value="0"></td>
      <td><output id="ExoT">0</output></td>
      <td><output id="ExoL">5</output></td>
  </tr>
  <tr oninput="updateStat('AuxP','AuxI','AuxT','AuxL');">
      <td>Auxiliary</td>
      <td><input type="number" id="AuxP" value="0"></td>
      <td><input type="number" id="AuxI" value="0"></td>
      <td><output id="AuxT">0</output></td>
      <td><output id="AuxL">5</output></td>
  </tr>
  <tr oninput="updateStat('MedP','MedI','MedT','MedL');">
      <td>Medical</td>
      <td><input type="number" id="MedP" value="0"></td>
      <td><input type="number" id="MedI" value="0"></td>
      <td><output id="MedT">0</output></td>
      <td><output id="MedL">5</output></td>
  </tr>
  <tr oninput="updateStat('GenP','GenI','GenT','GenL');">
      <td>Gen. Knowledge</td>
      <td><input type="number" id="GenP" value="0"></td>
      <td><input type="number" id="GenI" value="0"></td>
      <td><output id="GenT">0</output></td>
      <td><output id="GenL">5</output></td>
  </tr>
</table>

<p style="color: red; font-size:30px"><output id="SkillErrorText"></output></p>
<p>
  Total positive initial levels: <output id="PositiveSkillLevels">0</output></br>
  Total negative initial levels: <output id="NegativeSkillLevels">0</output>  <output id="NegativeSkillLevelDelta"></output></br>
  Total negative initial levels needed: <output id="NegativeSkillLevelsNeeded">0</output></br>
  Point total: <output id="TotalSkillPoints">0</output> (<output id="SkillMissions">0</output> Mission(s), <output id="SkillExtra">0</output> extra points)</br>
</p>

</body>
</html>
